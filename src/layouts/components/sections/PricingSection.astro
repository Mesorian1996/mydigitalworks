---
import type { z } from "astro/zod";
import { getEntryCTM } from "@/lib/customContentLoader.astro";
import { markdownify } from "@/lib/utils/textConverter";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import type { pricingSectionSchema } from "@/sections.schema";
import PricingCard from "@/layouts/components/cards/PricingCard.astro";

// Type for this section data
type pricingSectionSchema = NonNullable<z.infer<typeof pricingSectionSchema>>;

type Props = {
  content?: pricingSectionSchema;
};

// Fetching the default content for the this section
let defaultContent = (
  await getEntryCTM("sections", "pricing-section", Astro.currentLocale)
)?.data as pricingSectionSchema;

// Enables content customization (e.g., title, description) with a fallback to 'defaultContent' if not provided.
// The 'content' prop should match the structure of 'defaultContent'.
// Allows using this section with different content across multiple pages.
// If 'content' is missing, 'defaultContent' will be used.
let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as pricingSectionSchema;

// Extracting required values from 'content' object
let { enable = true, title, list } = actualContent || {};

if (!enable) {
  return null;
}
---

<section id="pricing" class="py-16 md:py-24">
  <div class="container space-y-14">
    <div class="space-y-3 text-center text-[#0f1c28]">
      <p class="text-xs uppercase tracking-[0.32em] text-[#476783]">P R E I S E & P A K E T E</p>
      <h2 class="text-h1-sm font-bold leading-tight md:text-h1">
        Professionelle Web-Auftritte, die Kunden überzeugen.
      </h2>
      <p class="text-base text-[#1f2a35] md:text-lg">
        Von erster Sichtbarkeit bis High-End-Marke – wählen Sie das Paket, das zu Ihrer Reise passt.
      </p>
    </div>

    <div class="grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3">
      {list.map((item) => <PricingCard content={item} />)}
    </div>

    <div class="text-center text-sm text-[#1f2a35]">
      Alle Pakete inkl. persönlicher Begleitung bis zum Launch. Transparente Festpreise, klare Timeline, saubere Übergabe.
    </div>
  </div>
</section>
