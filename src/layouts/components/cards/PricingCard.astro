---
import type { z } from "astro/zod";
import ReactIcons from "@/helpers/ReactIcons.astro";
import { markdownify } from "@/lib/utils/textConverter";
import type { pricingSectionSchema } from "@/sections.schema";
import CustomButton from "../CustomButton.astro";

type PricingCardType = NonNullable<
  z.infer<typeof pricingSectionSchema>
>["list"][0];

type Props = {
  content: PricingCardType;
  class?: string;
};

const {
  class: className,
  content: { enable, name, price, description, features, button },
  ...rest
} = Astro.props;

const orientation = (Astro.props as any)?.content?.orientation as string | undefined;
const shortDescription =
  ((Astro.props as any)?.content?.shortDescription as string | undefined) || description;

const isFeatured = name?.toLowerCase().includes("business");
---

{
  enable && (
    <div
      class:list={[
        "pricing-card flex flex-col justify-between space-y-8 rounded-3xl border p-7 md:p-8",
        isFeatured
          ? "pricing-card-featured scale-[1.08] border-[#f7b97d]/90 bg-gradient-to-br from-white to-[#fdf5eb] shadow-[0_28px_90px_-50px_rgba(247,185,125,0.85)] ring-1 ring-[#f7b97d]/60"
          : "border-[#d7c5aa]/70 bg-gradient-to-br from-white to-[#f7f0e4] shadow-[0_22px_70px_-48px_rgba(0,0,0,0.28)]",
        className,
      ]}
      data-pricing-card="true"
      data-featured={isFeatured ? "true" : undefined}
      {...rest}>
      <div class="space-y-3">
        <div class="flex items-start justify-between gap-3">
          {name && (
            <h3
              class="text-lg font-semibold tracking-tight text-[#0f1c28] md:text-xl"
              set:html={markdownify(name)}
            />
          )}
          {isFeatured && (
            <span class="rounded-full bg-[#f7b97d] px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.2em] text-[#0a1a2f]">
              MEISTGEWÃ„HLT
            </span>
          )}
        </div>
        {orientation && (
          <p class="text-xs text-[#1f2a35]/70">{orientation}</p>
        )}
        {price && (
          <div class="text-2xl font-primary font-semibold text-[#476783] md:text-3xl">
            {price.prependValue}
            {price.value}
            <span class="text-base md:text-lg">{price.appendValue}</span>
          </div>
        )}
        {shortDescription && (
          <p
            class="text-sm text-[#1f2a35]/85 md:text-base"
            set:html={markdownify(shortDescription)}
          />
        )}
      </div>
      {features && (
        <ul class="font-primary space-y-2.5 text-xs font-medium text-[#0f1c28] md:text-[13px]">
          {features.map((feature) => (
            <li class="flex items-start gap-2">
              <span class="mt-0.5 flex h-4 w-4 items-center justify-center shrink-0">
                <ReactIcons icon="IoMdCheckmark" class="h-4 w-4 text-[#476783]" />
              </span>
              <span class="leading-relaxed" set:html={markdownify(feature)} />
            </li>
          ))}
        </ul>
      )}
      {button?.enable && (
        <CustomButton
          class:list={[
            "text-center text-[11px] md:text-xs rounded-full px-4 py-2 md:px-4 md:py-2",
            isFeatured
              ? "bg-[#f7b97d] border-[#f7b97d] text-[#0a0f1a] hover:bg-[#0a0f1a] hover:border-[#0a0f1a] hover:text-[#f7b97d] focus-visible:ring-4 focus-visible:ring-[#f7b97d]/45"
              : "bg-[#476783] border-[#476783] text-white hover:bg-white hover:border-[#476783] hover:text-[#476783] focus-visible:ring-4 focus-visible:ring-[#476783]/35",
          ]}
          hoverEffect="creative-fill"
          {...button}
        />
      )}
    </div>
  )
}
