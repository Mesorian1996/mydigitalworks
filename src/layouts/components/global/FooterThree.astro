---
import { parseTomlToJson } from "@/lib/utils/tomlUtils";
import { markdownify } from "@/lib/utils/textConverter";
import { splitProtectedText } from "@/lib/utils/splitProtectedText";
import SocialComponent from "@/components/widgets/Social.astro";
import social from "@/config/social.json";
import { getEntryCTM } from "@/lib/customContentLoader.astro";
import ContactForm from "../widgets/ContactForm.astro";

const config = parseTomlToJson();

let {
  copyright,
  footerDescription,
  contactInfo: { address, email, phone },
} = config.settings;
const { footerSpaceTop = true } = Astro.props;

const {
  data: { title, description },
} = await getEntryCTM("sections", "call-to-action");

let { form } = (await getEntryCTM("sections", "contact-section"))?.data;

footerDescription = footerDescription || "";

const copyrightText =
  copyright.text ||
  "Copyright Â© {{ year }} MY Digital Studio. Alle Rechte vorbehalten.";
const copyrightParts = splitProtectedText(copyrightText);
---

<footer
  id="footer-with-contact"
  class:list={[ "bg-[#0A1A2F] text-white", !footerSpaceTop && "mt-0"]}>
  <div class="container pb-8 md:pb-16">
    <div
      class="grid grid-cols-1 gap-y-10 border-b border-white/15 py-16 md:py-24 lg:grid-cols-2 lg:gap-x-20 xl:gap-x-10">
      <div class="space-y-10">
        {
          title && (
            <h2
              class="text-display-6 xs:text-display-5 md:text-display-4 text-[#f7b97d]"
              set:html={markdownify(title)}
            />
          )
        }
        {
          description && (
            <div
              class="w-full max-w-lg text-lg text-white/80"
              set:html={markdownify(description, true)}
            />
          )
        }
        <div class="space-y-4">
          {
            config.settings.copyright?.enable && (
              <ul class="has-list has-list-slash prose-a:text-inherit flex flex-wrap gap-y-2 text-white/70">
                {copyrightParts.map((value) => (
                  <li class="prose-a:text-white/70 prose-a:hover:text-white">
                    <span set:html={markdownify(value)} />
                  </li>
                ))}
              </ul>
            )
          }

          <SocialComponent
            size="lg"
          layout="dark"
            class="gap-5"
            linkType="follow"
            list={social.main.filter((s) => s.enable)}
          />
        </div>
      </div>
      <div
        class="rounded-2xl bg-[#0f2643] p-6 shadow-xl text-white
               [&_.form-label]:text-white
               [&_.form-input]:!text-white
               [&_.form-input]:!caret-white
               [&_.form-input]:placeholder:text-white/70
               [&_.form-input]:border-white/60
               [&_.form-checkbox]:border-white/60
               [&_.form-radio]:border-white/60
               [&_.form-checkbox]:bg-transparent
               [&_.form-radio]:bg-transparent
               [&_.hs-select]:text-white
               [&_.hs-select button]:text-white
               [&_.hs-select button]:border-white/60">
        <ContactForm
          form={form}
          class="text-white [&_.form-label]:text-white [&_.form-input]:!text-white [&_.form-input]:!caret-white [&_.form-input]:placeholder:text-white/70 [&_.form-check-label]:text-white [&_.form-radio]:border-white/70 [&_.form-checkbox]:border-white/70 [&_.hs-select-button]:!text-white"
        />
      </div>
    </div>
    <div
      class="font-secondary flex flex-wrap items-center justify-between gap-x-8 gap-y-6 pt-6 text-sm leading-loose font-semibold uppercase text-white/70">
      <div class="flex flex-wrap items-center gap-4 text-white/70">
        <a class="hover:text-white" href="/kontakt">Kontakt</a>
        <a class="hover:text-white" href="/agb">AGB</a>
        <a class="hover:text-white" href="/datenschutz">Datenschutz</a>
        <a class="hover:text-white" href="/impressum">Impressum</a>
      </div>
      <div class="text-right md:text-end">
        {address && <p set:html={markdownify(address)} />}
        {phone && <p set:html={markdownify(phone)} />}
        {email && <p set:html={markdownify(email)} />}
      </div>
    </div>
  </div>
</footer>
